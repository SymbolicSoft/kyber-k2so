/* SPDX-FileCopyrightText: Â© 2020-2021 Nadim Kobeissi <nadim@symbolic.software>
 * SPDX-License-Identifier: MIT */

package kyberk2so

import (
	"crypto/subtle"
	"encoding/hex"
	"io/ioutil"
	"path/filepath"
	"regexp"
	"strings"
	"testing"
)

type kemTest struct {
	privateKey   string
	publicKey    string
	ciphertext   string
	sharedSecret string
}

func loadKemTests(t *testing.T) []kemTest {
	var kemTests []kemTest
	katPath := filepath.Join("assets", "PQCkemKAT_2400.rsp")
	katBytes, err := ioutil.ReadFile(katPath)
	if err != nil {
		t.Error(err)
	}
	kat := string(katBytes)
	rPk := regexp.MustCompile(`pk = [A-F0-9]+\n`)
	rSk := regexp.MustCompile(`sk = [A-F0-9]+\n`)
	rCt := regexp.MustCompile(`ct = [A-F0-9]+\n`)
	rSs := regexp.MustCompile(`ss = [A-F0-9]+\n`)
	allPk := rPk.FindAllString(kat, -1)
	allSk := rSk.FindAllString(kat, -1)
	allCt := rCt.FindAllString(kat, -1)
	allSs := rSs.FindAllString(kat, -1)
	for i := 0; i < len(allPk); i++ {
		test := kemTest{
			privateKey:   strings.TrimSuffix(allSk[i][5:], "\n"),
			publicKey:    strings.TrimSuffix(allPk[i][5:], "\n"),
			ciphertext:   strings.TrimSuffix(allCt[i][5:], "\n"),
			sharedSecret: strings.TrimSuffix(allSs[i][5:], "\n"),
		}
		kemTests = append(kemTests, test)
	}
	return kemTests
}

func decodeKemTest(test kemTest, t *testing.T) (
	[paramsSecretKeyBytes]byte, [paramsPublicKeyBytes]byte,
	[paramsIndcpaBytes]byte, [paramsSymBytes]byte,
) {
	var privateKey [paramsSecretKeyBytes]byte
	var publicKey [paramsPublicKeyBytes]byte
	var ciphertext [paramsIndcpaBytes]byte
	var sharedSecret [paramsSymBytes]byte
	sk, err := hex.DecodeString(test.privateKey)
	if err != nil {
		t.Error(err)
	}
	pk, err := hex.DecodeString(test.publicKey)
	if err != nil {
		t.Error(err)
	}
	ct, err := hex.DecodeString(test.ciphertext)
	if err != nil {
		t.Error(err)
	}
	ss, err := hex.DecodeString(test.sharedSecret)
	if err != nil {
		t.Error(err)
	}
	copy(privateKey[:], sk)
	copy(publicKey[:], pk)
	copy(ciphertext[:], ct)
	copy(sharedSecret[:], ss)
	return privateKey, publicKey, ciphertext, sharedSecret
}

func TestVectors(t *testing.T) {
	kemTests := loadKemTests(t)
	for i, test := range kemTests {
		privateKey, _, ciphertext, ssA := decodeKemTest(test, t)
		ssB, err := KemDecrypt(ciphertext, privateKey)
		if err != nil {
			t.Error(err)
		}
		if subtle.ConstantTimeCompare(ssA[:], ssB[:]) == 0 {
			t.Errorf("kat test vector %d failed", i)
		}
	}
}

func TestSelf(t *testing.T) {
	for i := 0; i < 10000; i++ {
		privateKey, publicKey, err := KemKeypair()
		if err != nil {
			t.Error(err)
		}
		ciphertext, ssA, err := KemEncrypt(publicKey)
		if err != nil {
			t.Error(err)
		}
		ssB, err := KemDecrypt(ciphertext, privateKey)
		if err != nil {
			t.Error(err)
		}
		if subtle.ConstantTimeCompare(ssA[:], ssB[:]) == 0 {
			t.Errorf("self test failed at iteration %d", i)
		}
	}
}

func BenchmarkKemKeypair(b *testing.B) {
	_, _, err := KemKeypair()
	if err != nil {
		b.Error(err)
	}
}

func BenchmarkKemEncrypt(b *testing.B) {
	publicKey := [paramsPublicKeyBytes]byte{
		201, 228, 108, 192, 66, 165, 61, 33, 12, 221, 18, 105, 218, 87, 160, 131, 99, 18, 198, 58, 202, 125, 22, 7, 160, 119, 132, 149, 204, 203, 16, 192, 53, 92, 72, 115, 251, 132, 150, 38, 57, 61, 7, 66, 138, 92, 240, 88, 30, 120, 165, 118, 71, 117, 157, 236, 60, 101, 147, 41, 59, 86, 165, 18, 154, 108, 199, 58, 129, 233, 106, 199, 18, 64, 44, 60, 102, 187, 149, 185, 137, 205, 219, 140, 128, 130, 204, 44, 251, 190, 10, 76, 87, 99, 135, 206, 137, 102, 41, 27, 134, 30, 40, 208, 45, 215, 181, 175, 144, 195, 167, 104, 108, 178, 28, 201, 204, 30, 220, 134, 176, 199, 97, 120, 229, 56, 14, 6, 186, 111, 171, 135, 78, 145, 1, 189, 52, 129, 48, 1, 110, 219, 185, 5, 222, 35, 114, 145, 234, 173, 74, 21, 48, 209, 74, 134, 247, 183, 123, 119, 40, 194, 33, 233, 10, 11, 138, 69, 163, 49, 29, 119, 226, 71, 243, 251, 133, 143, 153, 142, 38, 5, 145, 248, 85, 178, 79, 8, 46, 182, 208, 103, 121, 136, 194, 8, 43, 133, 234, 220, 108, 117, 82, 70, 233, 82, 69, 23, 197, 43, 33, 88, 174, 165, 177, 10, 34, 134, 5, 143, 204, 79, 149, 6, 178, 18, 71, 131, 30, 92, 188, 116, 40, 14, 22, 212, 90, 25, 11, 40, 158, 39, 42, 92, 200, 100, 186, 180, 126, 178, 102, 97, 62, 201, 146, 148, 135, 82, 11, 75, 179, 99, 6, 47, 239, 51, 64, 204, 40, 119, 54, 16, 99, 2, 251, 202, 68, 66, 89, 11, 161, 24, 247, 67, 81, 100, 245, 126, 219, 69, 2, 171, 119, 142, 175, 101, 185, 210, 80, 201, 92, 123, 89, 121, 99, 109, 191, 112, 38, 187, 22, 53, 41, 16, 160, 52, 35, 61, 252, 228, 67, 103, 48, 39, 176, 160, 126, 56, 246, 32, 131, 112, 74, 37, 96, 123, 217, 169, 133, 97, 163, 6, 190, 64, 118, 115, 112, 84, 23, 153, 1, 70, 138, 3, 81, 228, 120, 113, 210, 171, 166, 203, 132, 53, 112, 30, 128, 22, 110, 65, 18, 187, 27, 166, 128, 155, 232, 145, 246, 10, 177, 233, 182, 30, 179, 35, 5, 27, 129, 15, 23, 200, 138, 50, 41, 20, 107, 17, 52, 49, 133, 165, 90, 106, 153, 221, 89, 39, 110, 73, 9, 69, 43, 143, 146, 84, 181, 138, 128, 130, 127, 169, 107, 71, 5, 8, 204, 23, 185, 34, 203, 108, 148, 187, 195, 66, 164, 201, 91, 167, 186, 56, 230, 90, 65, 161, 13, 234, 91, 159, 100, 16, 174, 53, 149, 70, 198, 136, 112, 124, 211, 58, 9, 232, 27, 200, 11, 37, 56, 117, 181, 239, 153, 36, 81, 214, 190, 96, 123, 99, 205, 195, 31, 153, 212, 95, 186, 194, 95, 3, 73, 60, 199, 2, 183, 75, 19, 78, 25, 242, 171, 51, 244, 50, 126, 227, 147, 254, 18, 175, 227, 32, 20, 207, 19, 139, 72, 72, 115, 191, 12, 125, 220, 99, 80, 71, 244, 20, 72, 23, 3, 89, 138, 169, 125, 234, 66, 242, 154, 113, 185, 209, 63, 53, 135, 134, 201, 242, 18, 103, 240, 192, 16, 153, 73, 119, 72, 113, 5, 240, 36, 165, 104, 96, 249, 243, 45, 234, 187, 147, 30, 145, 20, 195, 203, 147, 30, 102, 36, 243, 248, 108, 67, 200, 67, 61, 148, 115, 226, 137, 73, 66, 217, 128, 85, 145, 206, 145, 247, 13, 187, 197, 187, 147, 211, 194, 226, 101, 163, 62, 55, 152, 222, 235, 73, 73, 92, 102, 241, 165, 100, 111, 148, 189, 107, 101, 18, 38, 226, 62, 234, 68, 190, 205, 71, 205, 44, 182, 174, 253, 172, 119, 159, 122, 155, 30, 18, 42, 85, 185, 91, 132, 184, 10, 104, 72, 111, 18, 34, 32, 73, 59, 86, 25, 56, 153, 15, 97, 195, 177, 92, 203, 102, 135, 103, 228, 43, 108, 18, 132, 182, 16, 16, 188, 110, 69, 195, 158, 4, 206, 164, 41, 44, 106, 241, 91, 251, 188, 34, 202, 103, 33, 160, 85, 99, 209, 67, 41, 108, 99, 141, 66, 187, 89, 79, 124, 118, 163, 73, 135, 254, 164, 132, 139, 89, 109, 158, 80, 152, 175, 227, 158, 122, 219, 101, 38, 155, 42, 14, 81, 111, 74, 5, 3, 66, 246, 46, 38, 72, 13, 57, 247, 32, 200, 129, 61, 131, 74, 31, 55, 116, 37, 26, 135, 142, 193, 84, 166, 125, 129, 81, 24, 136, 121, 224, 180, 162, 85, 242, 138, 86, 65, 50, 130, 83, 114, 51, 192, 72, 156, 116, 88, 28, 17, 176, 20, 37, 71, 190, 106, 25, 7, 124, 42, 156, 91, 35, 145, 148, 185, 102, 99, 184, 9, 90, 141, 169, 170, 152, 254, 168, 161, 106, 100, 45, 220, 40, 143, 230, 245, 9, 21, 35, 50, 161, 249, 181, 82, 90, 204, 178, 166, 151, 229, 179, 137, 216, 136, 147, 62, 234, 194, 239, 103, 104, 232, 43, 66, 6, 232, 50, 64, 171, 107, 56, 66, 122, 40, 117, 140, 134, 114, 111, 42, 244, 30, 180, 64, 49, 138, 44, 49, 125, 132, 78, 4, 241, 20, 32, 86, 164, 119, 133, 45, 64, 246, 154, 243, 10, 15, 184, 57, 116, 206, 138, 155, 91, 185, 126, 80, 165, 176, 25, 184, 182, 147, 87, 184, 161, 42, 112, 69, 55, 106, 69, 40, 183, 81, 11, 133, 126, 43, 143, 23, 92, 112, 68, 38, 154, 81, 185, 145, 185, 224, 86, 203, 246, 166, 70, 133, 53, 52, 216, 17, 49, 50, 123, 62, 226, 51, 153, 90, 159, 79, 177, 185, 51, 122, 22, 137, 44, 165, 239, 40, 126, 242, 153, 147, 166, 24, 142, 158, 197, 117, 113, 48, 125, 235, 1, 15, 145, 176, 122, 186, 37, 147, 201, 37, 66, 79, 163, 183, 157, 132, 163, 111, 160, 177, 6, 131, 150, 21, 60, 156, 239, 121, 199, 112, 71, 159, 91, 130, 168, 65, 187, 107, 177, 246, 153, 182, 193, 187, 63, 96, 37, 86, 88, 131, 52, 68, 189, 210, 153, 166, 251, 51, 138, 233, 138, 19, 0, 169, 79, 125, 140, 151, 92, 132, 93, 196, 252, 156, 175, 220, 161, 209, 243, 126, 16, 204, 89, 168, 210, 175, 71, 118, 207, 71, 57, 154, 76, 167, 159, 242, 60, 144, 108, 36, 0, 81, 120, 104, 178, 84, 3, 75, 58, 202, 215, 213, 63, 68, 24, 21, 21, 146, 25, 40, 220, 42, 213, 90, 87, 73, 200, 57, 92, 246, 197, 154, 166, 88, 50, 140, 47, 158, 99, 181, 203, 187, 73, 184, 87, 26, 180, 152, 107, 201, 60, 86, 146, 66, 143, 41, 124, 81, 1, 155, 33, 98, 24, 31, 211, 117, 246, 161, 40, 155, 140, 219, 254, 217, 246, 81, 141, 112, 49, 197, 127, 211, 69, 93, 69, 68, 115, 92, 245, 38, 128, 66, 76, 144, 241, 79,
	}
	_, _, err := KemEncrypt(publicKey)
	if err != nil {
		b.Error(err)
	}
}

func BenchmarkKemDecrypt(b *testing.B) {
	ciphertext := [paramsIndcpaBytes]byte{
		27, 63, 106, 213, 220, 72, 89, 15, 241, 228, 172, 7, 78, 145, 187, 146, 43, 231, 172, 118, 220, 189, 69, 218, 6, 111, 49, 201, 28, 149, 167, 166, 173, 233, 17, 191, 114, 224, 219, 164, 78, 87, 221, 79, 196, 196, 64, 29, 54, 123, 62, 125, 104, 219, 172, 51, 101, 3, 3, 69, 26, 45, 159, 9, 1, 88, 8, 113, 106, 28, 219, 15, 44, 251, 110, 76, 244, 156, 126, 167, 232, 183, 172, 238, 122, 151, 21, 52, 164, 11, 159, 114, 147, 205, 106, 164, 133, 190, 175, 72, 49, 44, 89, 78, 255, 21, 185, 87, 194, 118, 39, 253, 7, 147, 42, 230, 148, 47, 122, 202, 118, 115, 200, 205, 219, 49, 109, 159, 99, 43, 201, 232, 105, 43, 176, 241, 84, 148, 174, 27, 101, 202, 110, 39, 250, 30, 3, 162, 115, 199, 73, 231, 111, 94, 27, 129, 151, 64, 53, 80, 144, 96, 130, 130, 77, 224, 194, 156, 123, 5, 116, 58, 35, 203, 171, 220, 178, 70, 64, 170, 217, 182, 252, 147, 53, 159, 84, 39, 11, 50, 146, 93, 124, 178, 55, 60, 45, 170, 138, 185, 205, 100, 100, 73, 219, 106, 37, 39, 129, 15, 225, 181, 113, 83, 184, 29, 191, 11, 110, 116, 254, 21, 63, 242, 124, 126, 24, 168, 160, 8, 0, 231, 231, 97, 47, 31, 105, 88, 193, 123, 11, 87, 192, 71, 102, 251, 88, 102, 79, 136, 166, 214, 194, 122, 2, 219, 58, 14, 59, 127, 116, 70, 53, 95, 245, 21, 252, 41, 36, 86, 213, 19, 55, 246, 118, 151, 114, 150, 43, 80, 214, 217, 133, 94, 94, 125, 225, 125, 204, 247, 157, 76, 162, 100, 71, 106, 80, 31, 39, 210, 166, 192, 53, 23, 243, 45, 22, 244, 2, 254, 84, 68, 84, 191, 93, 193, 50, 64, 59, 167, 155, 129, 207, 6, 163, 142, 243, 179, 250, 164, 251, 194, 245, 75, 71, 55, 233, 102, 96, 234, 108, 79, 251, 194, 81, 169, 8, 6, 240, 179, 70, 191, 37, 96, 145, 174, 10, 155, 117, 162, 52, 196, 245, 11, 185, 28, 69, 83, 227, 31, 186, 68, 201, 63, 216, 183, 193, 76, 225, 220, 64, 14, 83, 161, 69, 55, 52, 203, 226, 24, 72, 163, 61, 30, 132, 106, 17, 244, 211, 34, 122, 216, 177, 218, 207, 92, 23, 251, 160, 55, 17, 28, 78, 176, 222, 216, 71, 8, 69, 97, 247, 74, 48, 230, 111, 100, 186, 158, 57, 145, 173, 67, 97, 82, 37, 34, 58, 121, 52, 40, 223, 78, 98, 199, 79, 10, 152, 222, 87, 189, 209, 136, 213, 61, 35, 222, 235, 230, 234, 254, 228, 30, 172, 162, 221, 196, 63, 21, 247, 181, 140, 223, 21, 233, 215, 78, 163, 51, 143, 67, 163, 248, 90, 10, 135, 238, 108, 22, 181, 36, 64, 88, 159, 251, 163, 96, 205, 119, 116, 244, 33, 66, 178, 56, 22, 176, 141, 210, 38, 146, 180, 239, 93, 88, 142, 235, 251, 98, 148, 170, 164, 49, 21, 144, 201, 125, 3, 249, 222, 173, 124, 108, 59, 24, 32, 114, 128, 147, 9, 240, 23, 49, 90, 186, 6, 214, 103, 233, 128, 194, 43, 24, 155, 3, 65, 113, 131, 247, 10, 167, 255, 206, 55, 242, 168, 24, 7, 157, 203, 119, 45, 61, 4, 185, 26, 140, 9, 198, 106, 54, 126, 160, 71, 57, 239, 169, 89, 169, 149, 15, 176, 137, 5, 179, 137, 124, 119, 103, 117, 194, 192, 173, 14, 231, 195, 243, 1, 152, 140, 20, 222, 205, 101, 42, 148, 124, 241, 34, 246, 231, 68, 87, 197, 110, 80, 170, 189, 64, 119, 147, 230, 75, 116, 98, 203, 210, 212, 101, 60, 78, 249, 168, 207, 200, 191, 219, 106, 75, 205, 238, 232, 169, 9, 51, 35, 27, 196, 194, 249, 174, 61, 158, 92, 20, 71, 230, 167, 213, 79, 186, 1, 166, 232, 155, 134, 36, 223, 221, 38, 70, 163, 125, 167, 171, 97, 252, 226, 138, 10, 8, 104, 85, 97, 149, 183, 215, 158, 38, 58, 45, 236, 57, 10, 6, 9, 11, 148, 20, 149, 144, 44, 243, 119, 171, 17, 88, 107, 13, 215, 86, 30, 171, 71, 207, 35, 132, 7, 199, 194, 229, 26, 190, 203, 95, 93, 78, 211, 35, 66, 25, 233, 99, 105, 43, 167, 221, 2, 174, 151, 228, 103, 78, 34, 244, 84, 77, 151, 127, 217, 209, 136, 17, 158, 38, 197, 82, 54, 82, 126, 73, 3, 45, 123, 140, 45, 123, 100, 133, 78, 36, 125, 102, 43, 141, 205, 38, 173, 5, 90, 69, 43, 39, 24, 67, 60, 223, 138, 164, 124, 213, 43, 10, 26, 112, 209, 185, 86, 102, 74, 107, 220, 31, 174, 83, 237, 95, 135, 133, 107, 102, 182, 104, 122, 168, 141, 134, 88, 145, 201, 95, 18, 194, 60, 134, 90, 115, 120, 165, 97, 119, 135, 144, 166, 134, 157, 29, 98, 187, 141, 235, 69, 66, 14, 92, 49, 137, 81, 15, 185, 240, 202, 130, 180, 135, 196, 48, 177, 214, 126, 231, 242, 44, 176, 143, 234, 151, 107, 151, 62, 154, 17, 127, 252, 107, 225, 90, 209, 147, 19, 124, 4, 88, 99, 118, 157, 131, 20, 134, 106, 199, 24, 210, 103, 216, 5, 65, 5, 206, 227, 13, 136, 93, 74, 103, 204, 77, 4, 207, 163, 13, 133, 218, 223, 161, 18, 143, 158, 51, 169, 234, 153, 243, 13, 116, 237, 120, 94, 87, 48, 106, 92, 2, 6, 162, 211, 133, 144, 219, 100, 90, 85, 236, 19, 221, 160, 114, 53, 241, 100, 102, 105, 125, 94, 192, 203, 86, 177, 212, 236, 251, 1, 216, 185, 105, 110, 115, 3, 96, 22, 59, 153, 184, 214, 176, 155, 233, 162, 41, 90, 123, 238, 33, 141, 160, 245, 235, 215, 24, 73, 63, 102, 57, 104, 9, 104, 95, 246, 191, 89, 110, 206, 126, 182, 204, 139, 212, 44, 167, 219, 170, 124, 192, 134, 204, 3, 0, 122, 143, 4, 47, 177, 244, 161, 53, 213, 195, 95, 198, 254, 188, 178, 122, 179, 85, 202, 24, 8, 169, 228, 30, 249, 40, 63, 17, 143, 191, 63, 160, 156, 29, 162, 67, 90, 40, 54, 84, 74, 32, 171, 105, 173, 55, 180, 106, 26, 201, 120, 97, 214, 242, 198, 186, 171, 125, 86, 108, 31, 42,
	}
	privateKey := [paramsSecretKeyBytes]byte{
		94, 67, 191, 232, 234, 68, 52, 102, 171, 107, 8, 125, 234, 220, 103, 46, 122, 173, 200, 85, 33, 213, 73, 185, 120, 176, 84, 169, 184, 148, 158, 81, 158, 63, 195, 166, 83, 96, 125, 121, 68, 145, 52, 16, 57, 113, 48, 55, 211, 28, 152, 36, 234, 206, 57, 231, 18, 122, 151, 68, 3, 68, 30, 37, 183, 20, 250, 251, 164, 185, 128, 65, 232, 91, 47, 216, 216, 172, 194, 166, 154, 234, 156, 128, 147, 3, 6, 180, 107, 175, 82, 69, 165, 5, 212, 142, 41, 58, 119, 170, 65, 116, 209, 192, 149, 176, 180, 164, 87, 84, 164, 169, 75, 203, 1, 212, 84, 59, 247, 199, 222, 242, 174, 32, 9, 64, 135, 37, 197, 139, 199, 107, 222, 3, 171, 239, 60, 78, 224, 131, 29, 60, 107, 38, 50, 96, 151, 7, 179, 184, 97, 240, 147, 232, 87, 144, 45, 82, 162, 164, 134, 25, 177, 236, 32, 221, 231, 169, 35, 65, 47, 121, 194, 35, 137, 96, 20, 115, 7, 105, 101, 149, 155, 42, 163, 199, 157, 211, 27, 152, 202, 152, 71, 115, 28, 137, 176, 146, 158, 245, 23, 76, 198, 185, 41, 114, 206, 44, 7, 200, 19, 154, 98, 201, 1, 33, 98, 69, 207, 201, 43, 45, 161, 88, 7, 158, 28, 147, 200, 224, 143, 244, 56, 160, 45, 220, 164, 202, 148, 143, 71, 161, 6, 212, 10, 182, 165, 176, 175, 175, 82, 5, 47, 35, 126, 68, 240, 118, 91, 52, 54, 39, 20, 33, 48, 134, 17, 132, 87, 133, 226, 87, 202, 230, 145, 195, 159, 184, 200, 11, 188, 28, 95, 214, 135, 165, 71, 183, 232, 227, 170, 29, 124, 21, 169, 24, 152, 75, 107, 53, 156, 210, 71, 17, 203, 187, 185, 87, 22, 234, 84, 168, 211, 81, 28, 93, 201, 131, 250, 27, 1, 158, 11, 13, 125, 233, 12, 60, 10, 158, 118, 82, 193, 142, 114, 202, 214, 249, 197, 16, 230, 79, 12, 218, 140, 189, 134, 80, 42, 88, 128, 238, 21, 54, 237, 209, 106, 179, 107, 207, 216, 89, 206, 135, 155, 63, 93, 106, 13, 144, 99, 6, 104, 183, 56, 92, 133, 153, 236, 177, 132, 154, 73, 66, 216, 122, 145, 73, 113, 41, 225, 150, 48, 145, 86, 201, 171, 36, 95, 76, 99, 112, 128, 201, 99, 249, 100, 143, 178, 186, 111, 50, 210, 86, 111, 136, 188, 230, 128, 32, 61, 251, 130, 116, 56, 41, 95, 134, 112, 201, 188, 195, 74, 152, 73, 120, 81, 189, 176, 230, 49, 234, 6, 172, 204, 38, 55, 56, 9, 152, 109, 166, 47, 167, 20, 1, 45, 37, 121, 213, 214, 20, 67, 51, 14, 59, 136, 44, 128, 11, 108, 157, 2, 201, 142, 152, 89, 164, 2, 45, 180, 160, 149, 16, 252, 145, 163, 185, 91, 203, 247, 59, 58, 9, 49, 28, 209, 62, 82, 182, 23, 51, 224, 45, 187, 64, 14, 138, 84, 163, 6, 104, 49, 26, 192, 47, 174, 43, 85, 254, 5, 201, 90, 196, 56, 117, 217, 47, 60, 42, 203, 61, 74, 107, 83, 211, 99, 213, 215, 90, 105, 112, 97, 5, 90, 58, 120, 139, 205, 250, 5, 30, 223, 151, 195, 81, 92, 169, 32, 235, 172, 158, 122, 153, 139, 181, 152, 184, 67, 107, 219, 99, 85, 14, 65, 109, 42, 234, 80, 87, 86, 42, 144, 27, 96, 155, 18, 157, 146, 178, 117, 54, 224, 44, 38, 236, 106, 59, 44, 95, 107, 115, 61, 5, 41, 51, 14, 154, 137, 96, 11, 8, 157, 211, 10, 11, 181, 37, 48, 163, 6, 43, 231, 65, 176, 152, 24, 167, 139, 79, 185, 242, 116, 183, 38, 44, 162, 59, 63, 42, 64, 84, 44, 170, 100, 254, 56, 166, 237, 6, 190, 181, 73, 135, 51, 163, 138, 127, 208, 181, 174, 194, 103, 58, 202, 43, 7, 224, 9, 9, 230, 141, 64, 170, 32, 127, 177, 121, 207, 122, 96, 169, 225, 55, 25, 99, 90, 21, 203, 34, 29, 28, 200, 139, 146, 30, 149, 12, 148, 206, 225, 125, 96, 248, 12, 165, 180, 166, 86, 245, 1, 215, 19, 109, 18, 69, 32, 116, 121, 161, 218, 66, 194, 108, 72, 102, 66, 151, 86, 42, 11, 174, 14, 121, 6, 233, 216, 83, 252, 124, 73, 14, 64, 120, 181, 179, 178, 38, 179, 113, 1, 163, 27, 93, 5, 162, 111, 28, 161, 242, 49, 168, 83, 242, 63, 89, 216, 106, 63, 210, 105, 160, 37, 110, 235, 208, 44, 192, 198, 183, 127, 27, 28, 97, 49, 20, 225, 8, 77, 141, 28, 186, 189, 12, 119, 2, 244, 61, 46, 224, 29, 185, 133, 56, 44, 86, 47, 27, 120, 133, 167, 1, 94, 223, 89, 189, 137, 136, 181, 188, 234, 28, 176, 70, 57, 187, 245, 177, 25, 230, 41, 63, 144, 130, 69, 69, 80, 112, 218, 48, 19, 210, 182, 226, 17, 103, 118, 105, 75, 68, 227, 167, 228, 51, 64, 112, 153, 165, 25, 64, 135, 11, 51, 111, 84, 118, 119, 102, 92, 112, 102, 225, 129, 206, 38, 111, 240, 229, 8, 38, 135, 49, 189, 19, 175, 162, 236, 180, 84, 98, 118, 165, 220, 80, 119, 42, 111, 163, 133, 65, 175, 150, 138, 229, 197, 158, 45, 4, 195, 182, 0, 44, 113, 32, 166, 169, 112, 173, 162, 103, 21, 144, 65, 21, 82, 228, 142, 113, 25, 199, 183, 247, 172, 151, 66, 158, 155, 124, 192, 181, 36, 45, 242, 119, 204, 16, 231, 196, 137, 118, 38, 102, 67, 169, 178, 48, 140, 241, 121, 147, 36, 120, 7, 67, 249, 94, 101, 133, 28, 3, 89, 159, 234, 113, 41, 213, 85, 43, 134, 172, 53, 174, 209, 11, 95, 0, 5, 138, 135, 66, 192, 42, 62, 79, 108, 191, 93, 246, 28, 102, 20, 62, 190, 147, 48, 96, 201, 138, 75, 181, 83, 24, 86, 97, 132, 96, 27, 179, 149, 98, 95, 200, 110, 75, 212, 115, 119, 181, 68, 89, 180, 94, 80, 193, 69, 89, 107, 145, 120, 213, 125, 1, 187, 186, 169, 166, 59, 244, 68, 136, 159, 200, 16, 241, 228, 14, 7, 210, 137, 224, 176, 74, 88, 248, 67, 72, 70, 59, 159, 202, 49, 118, 170, 174, 108, 28, 17, 156, 246, 121, 186, 204, 110, 182, 133, 185, 244, 67, 194, 169, 227, 4, 187, 160, 173, 243, 136, 139, 66, 105, 138, 193, 246, 143, 22, 38, 67, 158, 121, 110, 25, 103, 199, 190, 245, 129, 219, 171, 182, 194, 44, 156, 22, 2, 158, 24, 216, 73, 58, 82, 79, 194, 164, 23, 56, 162, 94, 115, 92, 102, 94, 121, 172, 66, 58, 202, 55, 181, 34, 45, 151, 3, 201, 228, 108, 192, 66, 165, 61, 33, 12, 221, 18, 105, 218, 87, 160, 131, 99, 18, 198, 58, 202, 125, 22, 7, 160, 119, 132, 149, 204, 203, 16, 192, 53, 92, 72, 115, 251, 132, 150, 38, 57, 61, 7, 66, 138, 92, 240, 88, 30, 120, 165, 118, 71, 117, 157, 236, 60, 101, 147, 41, 59, 86, 165, 18, 154, 108, 199, 58, 129, 233, 106, 199, 18, 64, 44, 60, 102, 187, 149, 185, 137, 205, 219, 140, 128, 130, 204, 44, 251, 190, 10, 76, 87, 99, 135, 206, 137, 102, 41, 27, 134, 30, 40, 208, 45, 215, 181, 175, 144, 195, 167, 104, 108, 178, 28, 201, 204, 30, 220, 134, 176, 199, 97, 120, 229, 56, 14, 6, 186, 111, 171, 135, 78, 145, 1, 189, 52, 129, 48, 1, 110, 219, 185, 5, 222, 35, 114, 145, 234, 173, 74, 21, 48, 209, 74, 134, 247, 183, 123, 119, 40, 194, 33, 233, 10, 11, 138, 69, 163, 49, 29, 119, 226, 71, 243, 251, 133, 143, 153, 142, 38, 5, 145, 248, 85, 178, 79, 8, 46, 182, 208, 103, 121, 136, 194, 8, 43, 133, 234, 220, 108, 117, 82, 70, 233, 82, 69, 23, 197, 43, 33, 88, 174, 165, 177, 10, 34, 134, 5, 143, 204, 79, 149, 6, 178, 18, 71, 131, 30, 92, 188, 116, 40, 14, 22, 212, 90, 25, 11, 40, 158, 39, 42, 92, 200, 100, 186, 180, 126, 178, 102, 97, 62, 201, 146, 148, 135, 82, 11, 75, 179, 99, 6, 47, 239, 51, 64, 204, 40, 119, 54, 16, 99, 2, 251, 202, 68, 66, 89, 11, 161, 24, 247, 67, 81, 100, 245, 126, 219, 69, 2, 171, 119, 142, 175, 101, 185, 210, 80, 201, 92, 123, 89, 121, 99, 109, 191, 112, 38, 187, 22, 53, 41, 16, 160, 52, 35, 61, 252, 228, 67, 103, 48, 39, 176, 160, 126, 56, 246, 32, 131, 112, 74, 37, 96, 123, 217, 169, 133, 97, 163, 6, 190, 64, 118, 115, 112, 84, 23, 153, 1, 70, 138, 3, 81, 228, 120, 113, 210, 171, 166, 203, 132, 53, 112, 30, 128, 22, 110, 65, 18, 187, 27, 166, 128, 155, 232, 145, 246, 10, 177, 233, 182, 30, 179, 35, 5, 27, 129, 15, 23, 200, 138, 50, 41, 20, 107, 17, 52, 49, 133, 165, 90, 106, 153, 221, 89, 39, 110, 73, 9, 69, 43, 143, 146, 84, 181, 138, 128, 130, 127, 169, 107, 71, 5, 8, 204, 23, 185, 34, 203, 108, 148, 187, 195, 66, 164, 201, 91, 167, 186, 56, 230, 90, 65, 161, 13, 234, 91, 159, 100, 16, 174, 53, 149, 70, 198, 136, 112, 124, 211, 58, 9, 232, 27, 200, 11, 37, 56, 117, 181, 239, 153, 36, 81, 214, 190, 96, 123, 99, 205, 195, 31, 153, 212, 95, 186, 194, 95, 3, 73, 60, 199, 2, 183, 75, 19, 78, 25, 242, 171, 51, 244, 50, 126, 227, 147, 254, 18, 175, 227, 32, 20, 207, 19, 139, 72, 72, 115, 191, 12, 125, 220, 99, 80, 71, 244, 20, 72, 23, 3, 89, 138, 169, 125, 234, 66, 242, 154, 113, 185, 209, 63, 53, 135, 134, 201, 242, 18, 103, 240, 192, 16, 153, 73, 119, 72, 113, 5, 240, 36, 165, 104, 96, 249, 243, 45, 234, 187, 147, 30, 145, 20, 195, 203, 147, 30, 102, 36, 243, 248, 108, 67, 200, 67, 61, 148, 115, 226, 137, 73, 66, 217, 128, 85, 145, 206, 145, 247, 13, 187, 197, 187, 147, 211, 194, 226, 101, 163, 62, 55, 152, 222, 235, 73, 73, 92, 102, 241, 165, 100, 111, 148, 189, 107, 101, 18, 38, 226, 62, 234, 68, 190, 205, 71, 205, 44, 182, 174, 253, 172, 119, 159, 122, 155, 30, 18, 42, 85, 185, 91, 132, 184, 10, 104, 72, 111, 18, 34, 32, 73, 59, 86, 25, 56, 153, 15, 97, 195, 177, 92, 203, 102, 135, 103, 228, 43, 108, 18, 132, 182, 16, 16, 188, 110, 69, 195, 158, 4, 206, 164, 41, 44, 106, 241, 91, 251, 188, 34, 202, 103, 33, 160, 85, 99, 209, 67, 41, 108, 99, 141, 66, 187, 89, 79, 124, 118, 163, 73, 135, 254, 164, 132, 139, 89, 109, 158, 80, 152, 175, 227, 158, 122, 219, 101, 38, 155, 42, 14, 81, 111, 74, 5, 3, 66, 246, 46, 38, 72, 13, 57, 247, 32, 200, 129, 61, 131, 74, 31, 55, 116, 37, 26, 135, 142, 193, 84, 166, 125, 129, 81, 24, 136, 121, 224, 180, 162, 85, 242, 138, 86, 65, 50, 130, 83, 114, 51, 192, 72, 156, 116, 88, 28, 17, 176, 20, 37, 71, 190, 106, 25, 7, 124, 42, 156, 91, 35, 145, 148, 185, 102, 99, 184, 9, 90, 141, 169, 170, 152, 254, 168, 161, 106, 100, 45, 220, 40, 143, 230, 245, 9, 21, 35, 50, 161, 249, 181, 82, 90, 204, 178, 166, 151, 229, 179, 137, 216, 136, 147, 62, 234, 194, 239, 103, 104, 232, 43, 66, 6, 232, 50, 64, 171, 107, 56, 66, 122, 40, 117, 140, 134, 114, 111, 42, 244, 30, 180, 64, 49, 138, 44, 49, 125, 132, 78, 4, 241, 20, 32, 86, 164, 119, 133, 45, 64, 246, 154, 243, 10, 15, 184, 57, 116, 206, 138, 155, 91, 185, 126, 80, 165, 176, 25, 184, 182, 147, 87, 184, 161, 42, 112, 69, 55, 106, 69, 40, 183, 81, 11, 133, 126, 43, 143, 23, 92, 112, 68, 38, 154, 81, 185, 145, 185, 224, 86, 203, 246, 166, 70, 133, 53, 52, 216, 17, 49, 50, 123, 62, 226, 51, 153, 90, 159, 79, 177, 185, 51, 122, 22, 137, 44, 165, 239, 40, 126, 242, 153, 147, 166, 24, 142, 158, 197, 117, 113, 48, 125, 235, 1, 15, 145, 176, 122, 186, 37, 147, 201, 37, 66, 79, 163, 183, 157, 132, 163, 111, 160, 177, 6, 131, 150, 21, 60, 156, 239, 121, 199, 112, 71, 159, 91, 130, 168, 65, 187, 107, 177, 246, 153, 182, 193, 187, 63, 96, 37, 86, 88, 131, 52, 68, 189, 210, 153, 166, 251, 51, 138, 233, 138, 19, 0, 169, 79, 125, 140, 151, 92, 132, 93, 196, 252, 156, 175, 220, 161, 209, 243, 126, 16, 204, 89, 168, 210, 175, 71, 118, 207, 71, 57, 154, 76, 167, 159, 242, 60, 144, 108, 36, 0, 81, 120, 104, 178, 84, 3, 75, 58, 202, 215, 213, 63, 68, 24, 21, 21, 146, 25, 40, 220, 42, 213, 90, 87, 73, 200, 57, 92, 246, 197, 154, 166, 88, 50, 140, 47, 158, 99, 181, 203, 187, 73, 184, 87, 26, 180, 152, 107, 201, 60, 86, 146, 66, 143, 41, 124, 81, 1, 155, 33, 98, 24, 31, 211, 117, 246, 161, 40, 155, 140, 219, 254, 217, 246, 81, 141, 112, 49, 197, 127, 211, 69, 93, 69, 68, 115, 92, 245, 38, 128, 66, 76, 144, 241, 79, 125, 133, 205, 26, 101, 131, 119, 13, 47, 114, 15, 137, 29, 133, 54, 29, 233, 39, 173, 15, 143, 31, 5, 93, 78, 179, 119, 21, 3, 184, 234, 237, 253, 90, 8, 246, 86, 166, 235, 140, 210, 6, 121, 147, 10, 49, 202, 166, 166, 51, 28, 75, 19, 58, 104, 56, 194, 35, 239, 159, 118, 159, 98, 70,
	}
	_, err := KemDecrypt(ciphertext, privateKey)
	if err != nil {
		b.Error(err)
	}
}
